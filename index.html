<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Web</title>
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow: hidden;
        }
        
        h1 {
            padding: 15px;
            text-align: center;
            background: #0d0d0d;
            border-bottom: 1px solid #333;
            font-size: 1.6em;
        }
        
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .editor-section {
            flex: 1;
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .preview {
            flex: 1;
            background: #fff;
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .section-header {
            padding: 10px 15px;
            background: #2d2d2d;
            border-bottom: 1px solid #444;
            font-size: 0.9em;
            font-weight: 600;
            color: #fff;
        }
        
        .editor-label {
            padding: 8px 15px;
            background: #252526;
            font-size: 0.8em;
            font-weight: bold;
            color: #bbb;
            border-bottom: 1px solid #333;
        }
        
        .editor-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 120px;
        }
        
        .monaco-editor-container {
            flex: 1;
            min-height: 100px;
        }
        
        .resizer-vertical {
            height: 6px;
            background: #444;
            cursor: row-resize;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
        }
        
        .resizer-vertical:hover {
            background: #008CBA;
        }
        
        .resizer-horizontal {
            width: 6px;
            background: #444;
            cursor: col-resize;
        }
        
        .resizer-horizontal:hover {
            background: #008CBA;
        }
        
        #previewFrame {
            width: 100%;
            height: 100%;
            border: none;
            background: #fff;
            flex: 1;
        }
        
        .download-button {
            padding: 15px;
            background: #008CBA;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        .download-button:hover {
            background: #007B9A;
        }
        
        @media (max-width: 768px) {
            .container { 
                flex-direction: column; 
            }
            
            .resizer-horizontal {
                width: 100%;
                height: 6px;
                cursor: row-resize;
            }
        }
    </style>
</head>
<body>
    <h1>Editor de Páginas Web</h1>
    
    <div class="container">
        <div class="editor-section" id="editorPanel">
            <div class="section-header">Editor de Código</div>
            
            <div class="editor-label">HTML</div>
            <div class="editor-wrapper" id="htmlEditorWrapper">
                <div id="htmlEditor" class="monaco-editor-container"></div>
            </div>
            
            <div class="resizer-vertical" id="resizerHtmlCss"></div>
            
            <div class="editor-label">CSS</div>
            <div class="editor-wrapper" id="cssEditorWrapper">
                <div id="cssEditor" class="monaco-editor-container"></div>
            </div>
            
            <div class="resizer-vertical" id="resizerCssJs"></div>
            
            <div class="editor-label">JavaScript</div>
            <div class="editor-wrapper" id="jsEditorWrapper">
                <div id="jsEditor" class="monaco-editor-container"></div>
            </div>
            
            <button class="download-button" onclick="downloadFiles()">Descargar HTML</button>
        </div>
        
        <div class="resizer-horizontal" id="resizerHorizontal"></div>
        
        <div class="preview">
            <div class="section-header">Vista Previa</div>
            <iframe id="previewFrame"></iframe>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
    <script>
        var htmlEditor, cssEditor, jsEditor;
        
        require.config({ 
            paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }
        });
        
        require(['vs/editor/editor.main'], function() {
            htmlEditor = monaco.editor.create(document.getElementById('htmlEditor'), {
                value: '<!DOCTYPE html>\n<html>\n<head>\n    <title>Mi Página</title>\n</head>\n<body>\n    <h1>Hola Mundo</h1>\n    <p>Este es mi párrafo</p>\n    <button>Mi Botón</button>\n</body>\n</html>',
                language: 'html',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: false },
                autoClosingTags: 'always'
            });

            cssEditor = monaco.editor.create(document.getElementById('cssEditor'), {
                value: 'body {\n    font-family: Arial, sans-serif;\n    background-color: #f0f0f0;\n    padding: 20px;\n}\n\nh1 {\n    color: #333;\n    text-align: center;\n}\n\nbutton {\n    background-color: #4CAF50;\n    color: white;\n    padding: 10px 20px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}',
                language: 'css',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: false }
            });

            jsEditor = monaco.editor.create(document.getElementById('jsEditor'), {
                value: 'document.addEventListener("DOMContentLoaded", function() {\n    var button = document.querySelector("button");\n    if (button) {\n        button.addEventListener("click", function() {\n            alert("¡Botón presionado!");\n        });\n    }\n});',
                language: 'javascript',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: false }
            });

            htmlEditor.onDidChangeModelContent(function() {
                autoCloseHTMLTags();
                updatePreview();
            });
            
            cssEditor.onDidChangeModelContent(updatePreview);
            jsEditor.onDidChangeModelContent(updatePreview);

            updatePreview();
            setupResizers();
        });

        function autoCloseHTMLTags() {
            try {
                if (!htmlEditor) return;
                
                var model = htmlEditor.getModel();
                if (!model) return;
                
                var position = htmlEditor.getPosition();
                if (!position) return;
                
                var lineContent = model.getLineContent(position.lineNumber);
                var beforeCursor = lineContent.substring(0, position.column - 1);
                
                var tags = ['p', 'button', 'div', 'span', 'h1', 'h2', 'h3', 'a', 'strong', 'em', 'li', 'ul', 'ol'];
                
                for (var i = 0; i < tags.length; i++) {
                    var tag = tags[i];
                    var openTag = '<' + tag + '>';
                    var closeTag = '</' + tag + '>';
                    
                    if (beforeCursor.endsWith(openTag)) {
                        var afterCursor = lineContent.substring(position.column - 1);
                        
                        if (afterCursor.indexOf(closeTag) === -1) {
                            var edit = {
                                range: {
                                    startLineNumber: position.lineNumber,
                                    startColumn: position.column,
                                    endLineNumber: position.lineNumber,
                                    endColumn: position.column
                                },
                                text: closeTag
                            };
                            
                            model.pushEditOperations([], [edit], function() { return null; });
                            htmlEditor.setPosition({
                                lineNumber: position.lineNumber,
                                column: position.column
                            });
                        }
                        break;
                    }
                }
            } catch (error) {
                console.log('Error en autocompletado');
            }
        }

        function updatePreview() {
            try {
                if (!htmlEditor || !cssEditor || !jsEditor) return;
                
                var html = htmlEditor.getValue();
                var css = cssEditor.getValue();
                var js = jsEditor.getValue();
                
                var preview = document.getElementById('previewFrame');
                if (!preview) return;
                
                var doc = preview.contentDocument || preview.contentWindow.document;
                
                var content = '<!DOCTYPE html><html><head><meta charset="UTF-8"><style>' + css + '</style></head><body>' + html + '<script>' + js + '</script></body></html>';
                
                doc.open();
                doc.write(content);
                doc.close();
            } catch (error) {
                console.log('Error en vista previa');
            }
        }

        function setupResizers() {
            var resizerHorizontal = document.getElementById('resizerHorizontal');
            var editorPanel = document.getElementById('editorPanel');
            var isResizing = false;

            resizerHorizontal.addEventListener('mousedown', function(e) {
                isResizing = true;
                e.preventDefault();
            });

            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;

                var containerWidth = document.querySelector('.container').offsetWidth;
                var newWidth = (e.clientX / containerWidth) * 100;
                
                if (newWidth > 20 && newWidth < 80) {
                    editorPanel.style.flex = '0 0 ' + newWidth + '%';
                }
            });

            document.addEventListener('mouseup', function() {
                if (!isResizing) return;
                isResizing = false;
                
                setTimeout(function() {
                    if (htmlEditor) htmlEditor.layout();
                    if (cssEditor) cssEditor.layout();
                    if (jsEditor) jsEditor.layout();
                }, 100);
            });

            setupVerticalResizer('resizerHtmlCss', 'htmlEditorWrapper', 'cssEditorWrapper');
            setupVerticalResizer('resizerCssJs', 'cssEditorWrapper', 'jsEditorWrapper');
        }

        function setupVerticalResizer(resizerId, topId, bottomId) {
            var resizer = document.getElementById(resizerId);
            var topElement = document.getElementById(topId);
            var bottomElement = document.getElementById(bottomId);
            
            var isResizing = false;
            var startY = 0;
            var startTopHeight = 0;
            var startBottomHeight = 0;

            resizer.addEventListener('mousedown', function(e) {
                isResizing = true;
                startY = e.clientY;
                startTopHeight = topElement.offsetHeight;
                startBottomHeight = bottomElement.offsetHeight;
                e.preventDefault();
            });

            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;

                var deltaY = e.clientY - startY;
                var newTopHeight = startTopHeight + deltaY;
                var newBottomHeight = startBottomHeight - deltaY;
                var minHeight = 100;

                if (newTopHeight >= minHeight && newBottomHeight >= minHeight) {
                    topElement.style.flex = '0 0 ' + newTopHeight + 'px';
                    bottomElement.style.flex = '0 0 ' + newBottomHeight + 'px';
                }
            });

            document.addEventListener('mouseup', function() {
                if (!isResizing) return;
                isResizing = false;
                
                setTimeout(function() {
                    if (htmlEditor) htmlEditor.layout();
                    if (cssEditor) cssEditor.layout();
                    if (jsEditor) jsEditor.layout();
                }, 100);
            });
        }

        function downloadFiles() {
            try {
                if (!htmlEditor || !cssEditor || !jsEditor) {
                    alert('Error: Los editores no están listos');
                    return;
                }

                var html = htmlEditor.getValue();
                var css = cssEditor.getValue();
                var js = jsEditor.getValue();

                var fullHTML = '<!DOCTYPE html>\n<html lang="es">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Mi Página Web</title>\n    <style>\n' + css + '\n    </style>\n</head>\n<body>\n' + html + '\n    <script>\n' + js + '\n    </script>\n</body>\n</html>';

                var blob = new Blob([fullHTML], { type: 'text/html' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'mi-pagina-web.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('Error al descargar el archivo');
            }
        }

        window.addEventListener('resize', function() {
            setTimeout(function() {
                if (htmlEditor) htmlEditor.layout();
                if (cssEditor) cssEditor.layout();
                if (jsEditor) jsEditor.layout();
            }, 100);
        });
    </script>
</body>
</html>
